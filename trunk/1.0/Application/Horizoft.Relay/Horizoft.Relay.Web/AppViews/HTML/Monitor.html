<html>
<head>
	<title></title>
	<link rel="stylesheet" href="/Styles/pagestructure.css">
	<link rel="stylesheet" href="/Styles/menu_left.css">
	<link rel="stylesheet" href="/Styles/component_library.css">
    <link rel="stylesheet" href="/Styles/page-input.css">
    <link rel="stylesheet" href="/Styles/popup.css">
	<style>

	</style>

	<script type="text/javascript" src="/Scripts/jquery-1.10.2.min.js"></script>
	
    <script type="text/javascript" src="/AppScripts/Utilities/jquery.utilities.js"></script>
	<script type="text/javascript" src="/AppScripts/Utilities/jquery.utilities.string.js"></script>
	<script type="text/javascript" src="/AppScripts/Utilities/Utilities.API.js"></script>
	<script type="text/javascript" src="/AppScripts/Utilities/horizoft.jquery.menu.js"></script>
    <script type="text/javascript" src="/AppScripts/Utilities/horizoft.jquery.webapi.js"></script>
    <script type="text/javascript" src="/AppScripts/Utilities/horizoft.jquery.popup.js"></script>
    <script type="text/javascript" src="/AppScripts/API/MonitorAPI.js"></script>
    <script type="text/javascript" src="/AppScripts/DTO/DTMonitor.js"></script>
	<script>

	    var monitorApi = new MonitorAPI();

        $(document).ready(function(){
            $("#menu-left").loadLeftMenu("../Home/LeftMenu.html", "blue-highlight");

            $("#popup-warning").popup({ status: "init" });
            $("#popup-notification").popup({ status: "init" });

            var api = monitorApi.GetFirst();

            if (api.error == undefined) {
                var monitor = api.data;
                if ((monitor || '') != '')
                    $(".form-input").bindView(monitor);  
            }
            else {
                $("#popup-notification").popup({ show: true, message: "Failed to load host setting." });
                //$(".command-green").prop('disabled', true);
            }
        })

        $(document).on("click", "[data-action='Monitor-Save']", function () {
            $("#popup-warning").popup({ show: true, message: "Do you want to change mail setting?", eventName: "onSaveMonitor" });
        })

        $(document).on("click", "[data-action='Monitor-Reset']", function () {
            $("#popup-warning").popup({ show: true, message: "Do you want to Reset mail setting?", eventName: "onResetMonitor" });
        })

        $(document).on("onSaveMonitor", "#popup-warning", function () {
            var monitor = $("#monitor-item").retrieve(new DTMonitor());

            if (monitor.id != '') {
                var result = monitorApi.Update(monitor);

                if (result.error == undefined) 
                    $("#popup-notification").popup({ show: true, message: "Monitor data saved successfully." });
                else
                    $("#popup-notification").popup({ show: true, message: "Failed to save monitor data." });
                
            }
            else {
                var result = monitorApi.Add(monitor);

                if (result.error == undefined)
                    $("#popup-notification").popup({ show: true, message: "Monitor data saved successfully." });
                else
                    $("#popup-notification").popup({ show: true, message: "Failed to save monitor data." });

            }
                
        })

        $(document).on("onResetMonitor", "#popup-warning", function () {
            var monitor = $("#monitor-item").retrieve(new DTMonitor());
            monitor.logURL = "";
            monitor.temperatureAlert = "";

            var result = monitorApi.Update(monitor);

            if (result.error == undefined)
                $("#popup-notification").popup({ show: true, message: "Monitor data reset successfully." });
            else
                $("#popup-notification").popup({ show: true, message: "Failed to reset monitor data." });
        })

		</script>
</head>

<body>
	<div class="view-section-left">
		<div class="view-section-left-head">HORIZOFT Relay</div>
		<div class="view-section-left-container">
			<div id="menu-left" class="menu-left">
			</div>
		</div>
	</div><!--
	--><div class="view-section-center">
		<div class="view-section-center-head">Monitor</div>
		<div class="view-section-center-container">
            <div class="card card-3">
                <table id="monitor-item" class="form-input">
                    <tbody>
                        <tr>
                            <td>Log URL</td>
                            <td>
                                <input type="text" data-field="logURL" />
                                <input type="text" data-field="id" hidden />
                            </td>
                        </tr>
                        <tr>
                            <td>Temperature Alert</td>
                            <td><input type="text" data-field="temperatureAlert" /></td>
                        </tr>
                    </tbody>
                </table>
                <div class="form-command-container">
                    <div class="form-command" style="float:left">
                        <button class="command-red" data-action="Monitor-Reset">Reset</button>
                    </div>
                    <div class="form-command" style="float:right">
                        <button class="command-green" data-action="Monitor-Save">Save</button>
                        <button class="command-red" data-action="Monitor-Cancel">Cancel</button>
                    </div>
                </div>
           </div>
            <div id="popup-notification" class="popup-view">
                <div class="form-command-container">
                    <div data-field="popup_message"></div>
                    <div><br/></div>
                    <div data-field="host"></div>
                    <div class="form-command">
                        <button class="command-green">Close</button>
                    </div>
                </div>
            </div>
            <div id="popup-warning" class="popup-view">
                <div class="form-command-container">
                    <div data-field="popup_message"></div>
                    <div><br/></div>
                    <div class="form-command">
                        <button class="command-green" data-popup-event="true">Yes</button>
                        <button class="command-red">No</button>
                    </div>
                </div>
            </div>
        </div>
	</div>
</body>

</html>