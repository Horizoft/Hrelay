<html>
<head>
	<title></title>
	<link rel="stylesheet" href="/Styles/pagestructure.css">
	<link rel="stylesheet" href="/Styles/menu_left.css">
	<link rel="stylesheet" href="/Styles/component_library.css">
    <link rel="stylesheet" href="/Styles/jquery-te-1.4.0.css">
    <link rel="stylesheet" href="/Styles/page-input.css">
    <link rel="stylesheet" href="/Styles/popup.css">
	<style>

        .jqte {
            margin: 0px;
            border: 0px solid rgba(0, 0, 0, 1);
        }

	</style>
	<!--<script type="text/javascript" src="/Scripts/jquery-1.10.2.js"></script>-->
	<script type="text/javascript" src="/Scripts/jquery-1.10.2.min.js"></script>
	<!--<script type="text/javascript" src="/Scripts/jquery-ui-1.11.4.custom/jquery-ui.js"></script>-->
    <script type="text/javascript" src="/Scripts/jquery-te-1.4.0.min.js"></script>
	
    <script type="text/javascript" src="/AppScripts/Utilities/jquery.utilities.js"></script>
	<script type="text/javascript" src="/AppScripts/Utilities/jquery.utilities.string.js"></script>
	<script type="text/javascript" src="/AppScripts/Utilities/Utilities.API.js"></script>
	<script type="text/javascript" src="/AppScripts/Utilities/horizoft.jquery.menu.js"></script>
    <script type="text/javascript" src="/AppScripts/Utilities/horizoft.jquery.webapi.js"></script>
    <script type="text/javascript" src="/AppScripts/Utilities/horizoft.jquery.popup.js"></script>
    <script type="text/javascript" src="/AppScripts/API/MailAPI.js"></script>
    <script type="text/javascript" src="/AppScripts/DTO/DTMail.js"></script>
	<script>
	    var mailApi = new MailAPI();

	    $(document).ready(function () {
            $("#menu-left").loadLeftMenu("../Home/LeftMenu.html", "blue-highlight");

            $("#popup-warning").popup({ status: "init" });
            $("#popup-notification").popup({ status: "init" });

            var api = mailApi.GetFirst();

            if (api.error == undefined) {
                var mail = api.data;
                if ((mail || '') != '')
                    $(".form-input").bindView(mail);

                $(".form-input-message").jqte();
            }
            else {
                $("#popup-notification").popup({ show: true, message: "Failed to load mail setting." });
                $(".command-green").prop('disabled', true);
            }

        })

        $(document).on("click", "[data-action='Mail-Save']", function () {
            $("#popup-warning").popup({ show: true, message: "Do you want to change mail setting?", eventName: "onSaveMail" });
        })

        $(document).on("click", "[data-action='Mail-Reset']", function () {
            $("#popup-warning").popup({ show: true, message: "Do you want to reset mail setting?", eventName: "onResetMail" });
        })

        $(document).on("onSaveMail", "#popup-warning", function () {
             var mail = $("#mail-input").retrieve(new DTMail());
             mail.message = $(".jqte_editor").html();

             if (mail.id != '') {
                 var result = mailApi.Update(mail);

                 if(result.error == undefined)
                     $("#popup-notification").popup({ show: true, message: "Mail data saved successfully." });
                 else
                     $("#popup-notification").popup({ show: true, message: "Failed to save mail data." });

             } else {
                 var result = mailApi.Add(mail);

                 if (result.error == undefined)
                     $("#popup-notification").popup({ show: true, message: "Mail data saved successfully." });
                 else
                     $("#popup-notification").popup({ show: true, message: "Failed to save mail data." });
             }
                
        })

        $(document).on("onResetMail", "#popup-warning", function () {
            var mail = $("#mail-input").retrieve(new DTMail());
            mail.id = 0;
            mail.sender = "";
            mail.recipients = "";
            mail.subject = "";
            mail.message = "";

                var result = mailApi.Update(mail);

                if (result.error == undefined)
                    $("#popup-notification").popup({ show: true, message: "Mail data saved successfully." });
                else
                    $("#popup-notification").popup({ show: true, message: "Failed to reset mail data." });
        
        })


		</script>
</head>

<body>
	<div class="view-section-left">
		<div class="view-section-left-head">HORIZOFT Relay</div>
		<div class="view-section-left-container">
			<div id="menu-left" class="menu-left">
			</div>
		</div>
	</div><!--
	--><div class="view-section-center">
		<div class="view-section-center-head">Mail</div>
		<div class="view-section-center-container">
            <div class="card card-3">
                <table id="mail-input" class="form-input">
                    <tbody>
                        <tr>
                            <td>Sender</td>
                            <td>
                                <input type="text" data-field="sender" />
                                <input type="text" data-field="id" hidden />
                            </td>
                        </tr>
                        <tr>
                            <td>Recipents</td>
                            <td><input type="text" data-field="recipients" /></td>
                        </tr>
                        <tr>
                            <td>Subject</td>
                            <td><input type="text" data-field="subject" /></td>
                        </tr>
                        <tr>
                            <td>Message</td>
                            <td>
                                <!--<div class="form-input-message" data-field="message"></div>-->
                                <textarea class="form-input-message" data-field="message">
                                </textarea>
                                <!--<textarea name="textarea" class="jqte-test"><b>My contents are from <u><span style="color:rgb(0, 148, 133);">TEXTAREA</span></u></b></textarea>-->
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="form-command-container">
                    <div class="form-command" style="float:left">
                        <button class="command-red" data-action="Mail-Reset">Reset</button>
                    </div>
                    <div class="form-command" style="float:right">
                        <button class="command-green" data-action="Mail-Save">Save</button>
                        <button class="command-red" data-action="Mail-Cancel">Cancel</button>
                    </div>
                </div>
            </div>
            <div id="popup-notification" class="popup-view">
                <div class="form-command-container">
                    <div data-field="popup_message"></div>
                    <div><br/></div>
                    <div data-field="host"></div>
                    <div class="form-command">
                        <button class="command-green">Close</button>
                    </div>
                </div>
            </div>
            <div id="popup-warning" class="popup-view">
                <div class="form-command-container">
                    <div data-field="popup_message"></div>
                    <div><br/></div>
                    <div class="form-command">
                        <button class="command-green" data-popup-event="true">Yes</button>
                        <button class="command-red">No</button>
                    </div>
                </div>
            </div>
        </div>
	</div>
</body>

</html>