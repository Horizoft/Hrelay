<html>
<head>
	<title></title>
	<link rel="stylesheet" href="/Styles/pagestructure.css">
	<link rel="stylesheet" href="/Styles/menu_left.css">
	<link rel="stylesheet" href="/Styles/component_library.css">
    <link rel="stylesheet" href="/Styles/page-input.css">
    <link rel="stylesheet" href="/Styles/popup.css">
	<style>

	</style>

	<!--<script type="text/javascript" src="/Scripts/jquery-1.10.2.js"></script>-->
	<script type="text/javascript" src="/Scripts/jquery-1.10.2.min.js"></script>
	<!--<script type="text/javascript" src="/Scripts/jquery-ui-1.11.4.custom/jquery-ui.js"></script>-->
    <script type="text/javascript" src="/Scripts/jquery-te-1.4.0.min.js"></script>
	
    <script type="text/javascript" src="/AppScripts/Utilities/jquery.utilities.js"></script>
	<script type="text/javascript" src="/AppScripts/Utilities/jquery.utilities.string.js"></script>
	<script type="text/javascript" src="/AppScripts/Utilities/Utilities.API.js"></script>
	<script type="text/javascript" src="/AppScripts/Utilities/horizoft.jquery.menu.js"></script>
    <script type="text/javascript" src="/AppScripts/Utilities/horizoft.jquery.webapi.js"></script>
    <script type="text/javascript" src="/AppScripts/Utilities/horizoft.jquery.popup.js"></script>
    <script type="text/javascript" src="/AppScripts/API/HostAPI.js"></script>
    <script type="text/javascript" src="/AppScripts/DTO/DTHost.js"></script>
	<script>

	    var hostApi = new HostAPI();

	    $(document).ready(function () {
	        $("#menu-left").loadLeftMenu("../Home/LeftMenu.html", "blue-highlight");

	        $("#popup-warning").popup({ status: "init" });
	        $("#popup-notification").popup({ status: "init" });

	        //var hostList = [
            //    { id: 1, host: "smtp.live.com", protocol: "SMTP", userName: "horizoft@hotmail.com", password: "p_12345" },
            //    { id: 2, host: "ews.horizoft.com", protocol: "EWS", userName: "ews@horizoft.com", password: "p_12345" }
	        //];

	        //var host = hostList[0];
	        var api = hostApi.GetLast();

	        if (api.error == undefined) {
	            var host = api.data;
	            if ((host || '') != '')
	                $(".form-input").bindView(host);
	        }
	        else {
	            $("#popup-notification").popup({ show: true, message: "Failed to load host setting." });
	            $("#btn-disabled").prop('disabled', true);
	        }
	    })

	    $(document).on("click", "[data-action='Host-Save']", function () {
	        $("#popup-warning").popup({ show: true, message: "Do you want to change host setting?", eventName: "onSaveHost" });
	    })

	    $(document).on("onSaveHost", "#popup-warning", function () {
	        var host = $("#host-item").retrieve(new DTHost());

	        if (host.id != ''){
	            var result = hostApi.Update(host);

	            if (result.error == undefined) {
	                $("#popup-notification").popup({ show: true, message: "Host data saved successfully." });
	                $(".form-input").bindView(result.data);
	            }
	            else
	                $("#popup-notification").popup({ show: true, message: "Failed to save Host data." });
	        }else{
	            var result = hostApi.Add(host);

	            if (result.error == undefined) {
	                $("#popup-notification").popup({ show: true, message: "Host data saved successfully." });
	                $(".form-input").bindView(result.data);
	            }
	            else
	                $("#popup-notification").popup({ show: true, message: "Failed to save Host data." });
            }
	            
	    })

	    $(document).on("click", "[data-action='Host-Reset']", function () {
	        $("#popup-warning").popup({ show: true, message: "Do you want to reset host setting?", eventName: "onResetHost" });
	    })

	    $(document).on("onResetHost", "#popup-warning", function () {
	        var defualt_host = hostApi.GetFirst(); //Defualt row 
	        var host = $("#host-item").retrieve(new DTHost());
	        //host.uRL = "";
	        //host.protocal = "";
	        //host.port = 0;
	        //host.username = "";
	        //host.password = "";
	        host.url = defualt_host.data.url;
	        host.protocal = defualt_host.data.protocal;
	        host.port = defualt_host.data.port;
	        host.userName = defualt_host.data.userName;
	        host.password = defualt_host.data.password;

	        var result = hostApi.Update(host);

	        if(result.error == undefined){
	            $("#popup-notification").popup({ show: true, message: "Host data reset successfully." });
	            $(".form-input").bindView(result.data);
	        }
	        else
	            $("#popup-notification").popup({ show: true, message: "Failed to reset host data." });

	    })


		</script>
</head>

<body>
	<div class="view-section-left">
        <div class="view-section-left-head">
            <div class="img-H">
                <img src="../../Images/H4.png" alt="relay" />
                <div class="view-section-left-head-name">Relay</div>
            </div>
        </div>
		<div class="view-section-left-container">
			<div id="menu-left" class="menu-left">
			</div>
		</div>
	</div><!--
	--><div class="view-section-center">
		<div class="view-section-center-head">Host</div>
		<div class="view-section-center-container">
            <div class="card card-3">
            <table id="host-item" class="form-input">
                <tbody>
                    <tr>
                        <td>Host</td>
                        <td>
                            <input type="text" data-field="url" />
                            <input type="text" data-field="id" hidden />
                        </td>
                    </tr>
                    <tr>
                        <td>Protocol</td>
                        <td>
                            <input type="text" data-field="protocal" /></td>
                    </tr>
                    <tr>
                        <td>Port</td>
                        <td>
                            <input type="text" data-field="port" /></td>
                    </tr>
                    <tr>
                        <td>User Name</td>
                        <td>
                            <input type="text" data-field="userName" /></td>
                    </tr>
                    <tr>
                        <td>Password</td>
                        <td>
                            <input type="text" data-field="password" /></td>
                    </tr>
                </tbody>
            </table>
            <div class="form-command-container">
                <div class="form-command" style="float: left">
                    <button class="command-red" data-action="Host-Reset">Reset</button>
                </div>
                <div class="form-command" style="float: right">
                    <button id="btn-disabled" class="command-green" data-action="Host-Save" >Save</button>
                    <button class="command-red" data-action="Host-Cancel">Cancel</button>
                </div>
            </div>
            <div id="popup-notification" class="popup-view">
                <div class="form-command-container">
                    <div data-field="popup_message"></div>
                    <div><br /></div>
                    <div data-field="host"></div>
                    <div class="form-command">
                        <button class="command-green">Close</button>
                    </div>
                </div>
            </div>
            <div id="popup-warning" class="popup-view">
                <div class="form-command-container">
                    <div data-field="popup_message"></div>
                    <div><br/></div>
                    <div class="form-command">
                        <button class="command-green" data-popup-event="true">Yes</button>
                        <button class="command-red">No</button>
                    </div>
                </div>
            </div>
            </div>
        </div>
	</div>
</body>

</html>